### Homework 3
#### Задание 1
Использовал traceroute с ключом -I под Linux, что соответствует использованию ICMP echo request. Использовал виртуальную машину с Ubuntu Server 20.04 и VPS с Ubuntu 18.04.  Основные выводы:
1. Из-за использования load balancer'ов путь пакета невозможно предсказать, поэтому количество хопов может варьироваться от запуска к запуску. traceroute по умолчанию отправляет три запроса, зачастую в одной строке ответа попадаются разные адреса отвечающих хостов.
2. Через слэш приведены неотвечающие хопы. В первом случае как минимум два скрываются моим провайдером (после попадания в сеть Golden Telecom почти все отвечают), в последнем случае часть хопов скрывает облачный хостинг Vultr.
3. Многие промежуточные хопы на ICMP не отвечают. Особенно много таковых в сети Amazon.

Site |  Hops from WSL | Hops from Vultr
-----|---------------|-----------------
cisco.com |18/4 | 15/6
yandex.ru | 10/3 | 7/4
microsoft.com (только промежуточные) | 23/3 |9/3
google.com | 13/2 | 14/5|
aws.amazon.com |19/7 | 15/9
habr.com | 11/2 | 8/4
stackoverflow.com |19/7| 15/9



#### Задание 2: OS guessing
Первая мысль - смотреть на TTL при ответе на ping. Примерно представляя себе количество хопов можно догадаться о TTL отправленного пакета. Например, от cisco.com приходят пакеты с TTL 237. traceroute показал длину пути в 18 хопов, то есть у исходного пакета был TTL 255, что соответствует OS Cisco IOS. 
Но от google.com 114 + 13 = 127 => Windows, что маловероятно. Не самая лучшая мысль, поскольку с помощью traceroute можно узнать длину пути только от нас к удаленному хосту, но не обратно, и TTL отправляемых пакетов может вручную задаваться отличным от дефолтного.

Попытка вторая - nmap с ключом -O. Очень часто попадается ответ *"OSScan results may be unreliable because we could not find at least 1 open and 1 closed port"*. OS в выводе чаще всего *Just Guessing*, почти у всех несколько вариантов (Linux, FreeBSD, OpenBSD) с вероятностями 86-87% и результаты отличаются от запроса к запросу. Вероятно, роль играет использование балансировщиков нагрузки, у cisco.com это всегда Citrix Load Balancer. У aws.amazon.com показывается Amazon Cloudfront - CDN. У habr.com - Qrator - Firewall.

Несколько лучших результатов можно добиться анализом вывода nmap -A. В этом случае можно смотреть чем управляется открытый порт (у всех это 80/tcp и 443/tcp). Чаще всего встречается x86_64-pc-linux-gnu, что вполне соответствует действительности. Можно вручную сделать HTTP запрос и посмотреть на сервер в заголовке ответа. 
У microsoft.com это Kestrel, работающий под Linux и Windows Server, но Microsoft давно перевели свои сервера на Linux.
У google.com это gws, в Википедии сказано, что он работает под Heavy Modified Debian Linux.
Вероятно, последний подход может предоставить хоть некоторую точность. Я проверил заведомо использующий IIS американский Красный Крест redcross.org. nmap -A подтверждает IIS на 80 и 443 портах, но Windows Server 2012 выдает даже не первой в списке.

#### Задание 3: Определение узких мест
